## Справочные таблицы

Эти таблицы содержат предопределенные или часто используемые значения.

### Таблица: `status`

| id | name                                         | description                                                         | type              |
|----|----------------------------------------------|---------------------------------------------------------------------|-------------------|
| 1  | Оформление заказа                          |                                                                     | order             |
| 2  | Заказан (не оплачен)                       | покупатель оформил заказ, но не оплатил.                              | order             |
| 3  | Оплачен                                      | продавец получил деньги, готовит товар.                               | order             |
| 4  | Отменён (до отправки)                      | заказ аннулирован до отправки.                                        | order             |
| 5  | Приобретён где-то ещё                      | покупатель нашёл аналогичный товар в другом месте.                  | order             |
| 6  | Решено не заказывать                       | покупатель отказался от покупки.                                     | order             |
| 7  | Ошибочно заказан (до отправки)             | товар не соответствует ожиданиям (не тот размер, цвет и т. д.).        | order             |
| 8  | Тестовый заказ (оформлен)                  | заказан образец для проверки перед массовой закупкой.                 | order             |
| 9  | Отложен (оформление)                       | заказ временно не оформляется, решение будет принято позже.           | order             |
| 10 | Подготовка и отправка                      |                                                                     | shipment          |
| 11 | Упакован                                     | товар подготовлен к отправке.                                        | shipment          |
| 12 | Отправлен                                    | передан транспортной компании.                                      | shipment          |
| 13 | Изменён адрес доставки                     | получатель запросил изменение адреса.                               | shipment          |
| 14 | Транспортировка                            |                                                                     | shipment          |
| 15 | В пути                                       | движется к стране назначения.                                        | shipment          |
| 16 | Прибыл в страну                              | достиг границы страны получателя.                                   | shipment          |
| 17 | На таможне                                   | проходит проверку.                                                  | shipment          |
| 18 | Растаможен                                   | допущен к доставке.                                                 | shipment          |
| 19 | Локальная доставка                         |                                                                     | shipment          |
| 20 | На доставке                                  | передан местному перевозчику.                                       | shipment          |
| 21 | В пункте выдачи                            | ожидает получения.                                                  | shipment          |
| 22 | Неудачная попытка доставки                 | курьер не смог доставить.                                           | shipment          |
| 23 | Получен                                      | покупатель подтвердил получение.                                    | order             |
| 24 | Неполучен                                    | покупатель не получил посылку.                                      | order             |
| 25 | Частично получен (из нескольких заказов)   | часть комплектующих пришла, часть ещё в пути.                         | order             |
| 26 | Частично утерян (из нескольких заказов)    | часть заказов утеряна.                                              | order             |
| 27 | Частично не заказан (из нескольких заказов) | какие-то части товара ещё не были оформлены.                        | order             |
| 28 | Утерян                                       | посылка пропала по дороге.                                          | order             |
| 29 | Повреждён                                    | товар повреждён в процессе доставки.                                | order             |
| 30 | Ошибочно заказан (финальный)               | заказан неверный товар (не тот размер, цвет, модель и т. д.), дальнейшие действия не определены. | order             |
| 31 | Тестовый заказ одобрен                     | образец устроил, можно заказывать партию.                            | order             |
| 32 | Тестовый заказ не одобрен                  | образец не устроил, массовый заказ не будет оформлен.               | order             |
| 33 | Возврат и споры                            |                                                                     | return_dispute    |
| 34 | Открыт спор                                  | покупатель подал претензию.                                         | return_dispute    |
| 35 | Спор: Ожидание решения                     | продавец/платформа рассматривает спор.                               | return_dispute    |
| 36 | Возвращён                                    | покупатель отправил товар обратно.                                  | return_dispute    |
| 37 | Возврат подтверждён                        | продавец получил возврат.                                           | return_dispute    |
| 38 | Возврат средств                            | деньги возвращены покупателю.                                       | return_dispute    |
| 39 | Активен в очереди                          | Элемент находится в активной очереди для рассмотрения или обработки. | queue             |
| 40 | На паузе в очереди                         | Элемент временно приостановлен в обработке.                          | queue             |
| 41 | Отменён (продавец)                         | Элемент удален из очереди по причине отмены продавцом.               | queue             |
| 42 | Обработка возврата/спора (в очереди)       | Элемент связан с текущим процессом возврата или спора.             | queue             |
| 43 | Завершён (очередь)                         | Элемент обработан из очереди (например, добавлен в корзину, архивирован). | queue             |
| 44 | Отложен (в очереди)                        | Элемент временно не обрабатывается в очереди, решение будет принято позже. | queue             |
| 45 | Решено не заказывать (в очереди)           | Принято решение не заказывать товар из очереди.                     | queue             |

### Таблица: `priority`

| id | name    | level | description            |
|----|---------|-------|------------------------|
| 1  | Lowest  | 0     | Minimal priority...    |
| 2  | Low     | 2     | Low priority...        |
| 3  | Medium  | 5     | Medium priority...     |
| 4  | High    | 7     | High priority...       |
| 5  | Critical| 10    | Immediate attention... |

### Таблица: `breadcrumb`
| id | parent_id | name                           |
|----|-----------|--------------------------------|
| 1  | NULL      | AliExpress                     |
| 2  | 1         | Обустройство дома и инструменты|
| 3  | 2         | Ремонт и обустройство          |
| 4  | 3         | Крепеж и скобяные изделия      |
| 5  | 4         | Пневматические детали          |
| 6  | 1         | Дом, сад и офис                |
| 7  | 6         | Лампы и освещение              |
| 8  | 7         | Светодиодное освещение         |
| 9  | 8         | Светодиодная лента             |

---

## Рабочий процесс: Тестовый заказ

Данные сгруппированы по этапам, как описано в `DATA_ORDER.md`.

### Этап 1: Поиск и Приоритезация

#### Таблица: `product`
| id | keyword                                       | wekan_task_id | created_at          | updated_at          | wekan_priority |
|----|-----------------------------------------------|---------------|---------------------|---------------------|----------------|
| 15 | разъём rj9 / rj10 / rj11; male plug connector; 4P4 plug RJ9/RJ10 |               | 2024-04-13 22:00:00 | 2024-04-13 22:00:00 | 3              |
| 76 | Аудио кабель 4-полюсный разъем стерео       |               | 2024-04-13 22:00:00 | 2024-04-13 22:00:00 | 0              |
| 52 | Клей Момент                                |               | 2024-08-16 10:00:00 | 2024-08-16 10:00:00 | 2              |
| 4  | Пневматическая быстроразъёмная муфта PCF 6-04 |               | 2021-03-20 00:00:00 | 2021-03-20 00:00:00 | 6              |
| 2  | RGB светодиодная лента HugSunLight         |               | 2024-07-21 00:00:00 | 2024-07-21 00:00:00 | 6              |
| 20 | Ручной пресс для чеснока                   |               | 2024-10-10 00:00:00 | 2024-10-10 00:00:00 | 3              |
| 6  | Медный провод 0,1, ~ длина 650 м -400 ПРОМОКОД COMBO |               | 2024-09-09 00:00:00 | 2024-09-09 00:00:00 | 5              |
| 75 | Трусы                                      |               | 2025-03-07 00:00:00 | 2025-03-07 00:00:00 | 1              |

#### Таблица: `catalog`
| id | product_id (FK) | name                                                  | url                                       | model                                     | cost  | breadcrumb_id (FK) | brand       | description                                   | barcode | vendor_code |
|----|-----------------|-------------------------------------------------------|-------------------------------------------|-------------------------------------------|-------|--------------------|-------------|-----------------------------------------------|---------|-------------|
| 1  | 4               | Белые пневматические фитинги 1/4 1/2 6 мм 8 мм BSP | aliexpress.ru/item/1005004135633297.html | Цвет 6-04 (6mm-1/2) Характеристики PCF | 273   | 5                  |             | Пневматическая быстроразъёмная муфта PCF 6-04 |         |             |
| 2  | 2               | RGB светодиодная лента HugSunLight 5 м                | aliexpress.ru/item/32780331531.html       | Длина 3m Испускаемый цвет Cold White Led Strip | 275   | 9                  | HugSunLight | RGB светодиодная лента HugSunLight         |         |             |

#### Таблица: `media`
| id | catalog_id (FK) | type    | url                             | alt_text                      | sort_order |
|----|-----------------|---------|---------------------------------|-------------------------------|------------|
| 1  | 1               | 'image' | 'fitting_pcf_6-04_main.jpg'     | 'Главное изображение фитинга'   | 0          |
| 2  | 1               | 'image' | 'fitting_pcf_6-04_dimensions.png'| 'Чертеж с размерами фитинга' | 1          |

#### Таблица: `offer`
| id | product_id (FK) | channel | price | status_id (FK) | available | acquisition_cost |
|----|-----------------|---------|-------|----------------|-----------|------------------|
|    |                 |         |       |                |           |                  |

#### Таблица: `competitor_price`
| id | product_id (FK) | competitor_name | price | recorded_at |
|----|-----------------|-----------------|-------|-------------|
| 1 | 2 | Ozon | 600.00 | [Timestamp] |

#### Таблица: `queue`
| id | product_id (FK) | status_id (FK) | priority_id (FK) | created_at | note |
|----|-----------------|----------------|------------------|------------|------|
| 1  | 15              | 42             | 2                | 2024-05-21 10:00:00 | 22 мая открыть спор для возврата средств |
| 2  | 76              | 42             | 2                | 2024-05-21 10:05:00 | 22 мая открыть спор для возврата средств |
| 3  | 52              | 39             | 2                | 2024-08-16 10:00:00 | |
| 4  | 4               | 41             | 3                | 2021-03-20 00:00:00 | Продавец потребовал отмены. Получено 100 баллов |
| 5  | 2               | 39             | 3                | [Timestamp] | |
| 6  | 20              | 39             | 2                | [Timestamp] | |
| 7  | 6               | 39             | 3                | [Timestamp] | -400 ПРОМОКОД COMBO |
| 8  | 75              | 40             | 1                | [Timestamp] | |

### Этап 2: Идентификация и Настройка Пользователя
*(Шаблоны таблиц без данных)*

#### Таблица: `user_account`
| id | username | password | email | created_at | default_shipping_address_id (FK) |
|----|----------|----------|-------|------------|----------------------------------|

#### Таблица: `address`
| id | street | city | state_province | postal_code | country | building_apt | details |
|----|--------|------|----------------|-------------|---------|--------------|---------|

### Этап 3: Корзина

#### Таблица: `basket`
| id | user_account_id (FK) | created_at | updated_at | total_amount | strategy |
|----|----------------------|------------|------------|--------------|----------|

#### Таблица: `basket_item`
| id | basket_id (FK) | product_id (FK) | qty | added_at | price_at_add | subtotal | queue_id (FK) |
|----|----------------|-----------------|-----|----------|--------------|----------|---------------|

### Этап 4: Оплата/Кошелек
*(Шаблоны таблиц без данных)*

#### Таблица: `payment`
| id | order_id (FK) | pay_method_id (FK) | paid_at | amount | cashback_received |
|----|---------------|--------------------|---------|--------|-------------------|

#### Таблица: `pay_method`
| id | name | wallet_id (FK) | currency_id (FK) | details |
|----|------|----------------|------------------|---------|

#### Таблица: `wallet`
| id | name | balance | currency_id (FK) |
|----|------|---------|------------------|

### Этап 5: Оформление Заказа и Доставка

#### Таблица: `order`
| id | user_account_id (FK) | order_date | status_id (FK) | total_amount | shipping_address_id (FK) | billing_address_id (FK) |
|----|----------------------|------------|----------------|--------------|--------------------------|-------------------------|

#### Таблица: `order_item`
| id | order_id (FK) | product_id (FK) | qty | price_per_item | subtotal | cost_of_goods_sold | sale_price | discount_amount | discount_description |
|----|---------------|-----------------|-----|----------------|----------|--------------------|------------|-----------------|----------------------|

#### Таблица: `shipment`
| id | order_id (FK) | shipped_at | delivered_at | tracking_number | status_id (FK) | shipping_cost | shipping_address_id (FK) |
|----|---------------|------------|--------------|-----------------|----------------|---------------|--------------------------|
