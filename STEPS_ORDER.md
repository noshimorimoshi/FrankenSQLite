# Рабочий Процесс Тестового Заказа для Сбора Данных

Этот документ описывает этапы рабочего процесса тестового заказа, следуя которому мы будем извлекать и фиксировать данные в DATA.md. Цель - собрать структурированные данные, необходимые для валидации и корректировки схемы базы данных в SCHEMA.md. Весь процесс направлен на упорядоченное заполнение таблиц базы данных SQLite, созданных на основе SCHEMA.md, данными, соответствующими тестовому рабочему процессу.

## 1. Приоритезация (Бэклог/Выбор Товаров)

На этом этапе мы определяем, какие товары потенциально интересны для заказа и отбираем те, с которыми предстоит работа, исходя из данных, уже находящихся или предполагаемых к хранению в базе данных, соответствующей SCHEMA.md.

*   **Исходные данные:** Данные о товарах, которые **предполагается хранить** в таблицах `product` и `queue` базы данных SQLite, структура которой соответствует `SCHEMA.md`. Приоритезация основана на анализе полей `status_id` и `priority_id` (а также `note`) из таблицы `queue`, связанных с информацией о товаре (`name`, URL) из таблицы `product`. Текущие методы приоритизации (на основе тегов и сортировочных столбцов в исходном представлении данных) **будут преобразованы** в значения, соответствующие полям `status_id` и `priority_id` в таблице `queue` (ссылающимся на таблицу `status` и `priority` соответственно). Отбор для дальнейшей работы производится на основе значений `status_id` и `priority_id`.

*   **Что фиксируем в DATA.md:**
    *   Для каждого рассмотренного товара:
        *   Идентификационные данные товара (например, Название и Ссылка), достаточные для последующего сопоставления с таблицей `product` в БД (`product_name`, `product_url`).
        *   Предполагаемое значение статуса для этого товара в очереди (`queue_status`), соответствующее возможному значению `status_id` в таблице `status` (и связанное с `queue` через `status_id`).
        *   Предполагаемое значение приоритета для этого товара в очереди (`queue_priority_name` или `queue_priority_level`), соответствующее полю `priority_id` в таблице `queue` (ссылающемуся на таблицу `priority`). Мы будем использовать здесь наименование приоритета или его числовой уровень для наглядности в DATA.md.
        *   Любые примечания или контекст, относящиеся к этому товару в очереди (`queue_note`), соответствующее полю `note` в таблице `queue`.
    *   Критерии отбора для перехода на следующий этап (например, определенные значения `queue_status` и `queue_priority_name`/`queue_priority_level`).
    *   Результат отбора: список товаров, выбранных для дальнейшей работы, с указанием их зафиксированных `queue_status` и `queue_priority_name`/`queue_priority_level`.

## 2. Поиск/Эффективность (Анализ Экономической Выгоды)

На этом этапе мы детально анализируем выбранные товары с точки зрения экономической выгоды и других факторов, используя данные из различных источников, которые в конечном итоге также будут отражены в БД.
*   **Исходные данные:** Информация о текущих ценах, скидках, купонах, кешбэке, стоимости доставки из различных источников (например, веб-сервисы, прайс-листы, данные конкурентов), которые должны быть сопоставлены с соответствующими полями в SCHEMA.md для последующей загрузки в БД. Эти данные будут в первую очередь сопоставляться с таблицами `offer` и `competitor_price`.
*   **Что фиксируем в DATA.md:**
    *   Для каждого выбранного товара:
        *   Финальная цена товара с учетом всех скидок и бонусов (`final_price`).
        *   Расчет потенциального кешбэка (`potential_cashback`).
        *   Сравнение с ценами конкурентов (если применимо) (`competitor_analysis_notes`).
        *   Причина выбора конкретного продавца/предложения (`offer_selection_reason`).

## 3. Корзина (Формирование Заказа)

На этом этапе выбранные товары добавляются в корзину и формируется сам заказ, с фиксацией данных, которые будут загружены в таблицы `basket` и `basket_item` в БД.
*   **Исходные данные:** Результаты этапа 2, информация о доступности товара, минимальном количестве для заказа (если есть) - данные, предназначенные для последующей загрузки в таблицы `product`, `basket_item` и, возможно, `product_inventory` в БД. Также учитывается стратегия формирования корзины (`basket_strategy`) для оптимизации под купоны или сравнения.
*   **Что фиксируем в DATA.md:**
    *   Идентификатор корзины (для группировки товаров) (`basket_id`).
    *   Стратегия формирования корзины (`basket_strategy`), соответствующая полю `strategy` в таблице `basket`.
    *   Для каждого товара в корзине:
        *   Идентификационные данные товара (`product_name`, `product_url`).
        *   Количество (`qty`), соответствующее полю `qty` в таблице `basket_item`.
        *   Цена на момент добавления в корзину (`price_at_add`), соответствующая полю `price_at_add` в таблице `basket_item`.
        *   Промежуточная стоимость данного товара (`subtotal`), соответствующая полю `subtotal` в таблице `basket_item`.
        *   Ссылка на исходный элемент очереди (если применимо) (`queue_id` - опционально для фиксации в DATA.md, но важно для схемы).
    *   Общая стоимость корзины (`basket_total_amount`), соответствующая полю `total_amount` в таблице `basket`.
    *   Примененные купоны или промокоды (`applied_coupons`), предназначенные для фиксации (возможно, в отдельной таблице или в поле `details` заказа/платежа).
    *   Выбранный способ доставки и его стоимость (предварительно) (`preliminary_shipping_method`, `preliminary_shipping_cost`), предназначенные для фиксации в таблице `shipment`.
    *   Промежуточный статус корзины/заказа (например, "в корзине", "оформляется"), соответствующий статусам в SCHEMA.md (связанным с таблицами `basket` или `order`).
    *   Итоговая стоимость с учетом доставки и скидок (предварительно) (`preliminary_final_amount`).

## 4. Оплата/Кошелек

На этом этапе выбирается метод оплаты, вносится и фиксируется необходимая сумма, с целью подготовки данных для таблиц `payment`, `pay_method` и `wallet` в БД.

*   **Исходные данные:** Общая стоимость заказа, доступные методы оплаты, информация о кошельках - данные, которые будут сопоставлены со `SCHEMA.md` и загружены в БД.

*   **Что фиксируем в DATA.md:**
    *   Идентификатор платежа (для группировки) (`payment_id`).
    *   Идентификатор заказа, к которому относится платеж (`order_id` - будет назначен позже, на этапе 5).
    *   Выбранный метод оплаты (`pay_method_name`), соответствующий полю `name` в таблице `pay_method`.
    *   Использованный кошелек или платежный аккаунт (если применимо) (`wallet_name`), соответствующий полю `name` в таблице `wallet`.
    *   Сумма платежа (`payment_amount`), соответствующая полю `amount` в таблице `payment`.
    *   Статус платежа (`payment_status`), соответствующий статусам в `SCHEMA.md` (связанным с таблицей `payment` через `status_id`).
    *   Расчетный или полученный кешбэк (`cashback_received`), соответствующий полю `cashback_received` в таблице `payment`.
    *   Детали транзакции (если доступны и не содержат чувствительных данных) (`transaction_details`), предназначенные для фиксации в БД (возможно, в поле `details` таблицы `payment`).
    *   Дата и время платежа (`paid_at`), соответствующее полю `paid_at` в таблице `payment`.

## 5. Регистрация/Заказ (Финальное Оформление и Данные Пользователя)

На этом этапе используются данные пользователя для оформления заказа и его окончательной регистрации в системе, с целью заполнения таблиц `user_account`, `order`, `shipment` и уточнения данных в `payment` и `order_item` в БД.

*   **Исходные данные:** Данные пользователя (логины, учетные записи, адреса), финальная информация о корзине, оплате и доставке - информация, которая будет взята из или подготовлена для соответствующих таблиц в БД согласно `SCHEMA.md`.

*   **Что фиксируем в DATA.md:**
    *   Идентификатор пользователя (или данные, позволяющие его идентифицировать в рамках теста) (`user_account_id`), соответствующий структуре БД.
    *   Идентификатор финального заказа (`order_id`), соответствующий первичному ключу таблицы `order`.
    *   Дата и время оформления заказа (`order_date`), соответствующее полю `order_date` в таблице `order`.
    *   Финальный статус заказа (`order_status`), соответствующий статусам в `SCHEMA.md` (связанным с таблицей `order` через `status_id`).
    *   Общая итоговая сумма заказа (`order_total_amount`), соответствующая полю `total_amount` в таблице `order`.
    *   Идентификатор выбранного адреса доставки (`shipping_address_id`), соответствующий внешнему ключу в таблице `order` и `shipment`.
    *   Идентификатор выбранного платежного метода (`pay_method_id`), соответствующий внешнему ключу в таблице `payment`.
    *   Информация о доставке (если доступно): идентификатор отгрузки (`shipment_id`), трекинг-номер (`tracking_number`), стоимость доставки (`shipping_cost`), предполагаемые даты отгрузки/доставки (`shipped_at`, `delivered_at` - предварительно).
    *   Уточненные данные по элементам заказа (`order_item`), включая финальные цены, скидки, стоимость товаров (`sale_price`, `discount_amount`, `cost_of_goods_sold`).

Следуя этим этапам, мы сможем собрать полный набор данных для тестового заказа в DATA.md, который затем будет использован для тщательной валидации и корректировки SCHEMA.md и, в конечном итоге, для упорядоченного заполнения базы данных SQLite.
