# Рабочий Процесс Тестового Заказа для Сбора Данных

Этот документ описывает этапы рабочего процесса тестового заказа, следуя которому мы будем извлекать и фиксировать данные в DATA.md. Цель - собрать структурированные данные, необходимые для валидации и корректировки схемы базы данных в SCHEMA.md. Весь процесс направлен на упорядоченное заполнение таблиц базы данных SQLite, созданных на основе SCHEMA.md, данными, соответствующими тестовому рабочему процессу.

## 1. Приоритезация (Бэклог/Выбор Товаров)

На этом этапе мы определяем, какие товары потенциально интересны для заказа и отбираем те, с которыми предстоит работа, исходя из данных, уже находящихся или предполагаемых к хранению в базе данных, соответствующей SCHEMA.md.

*   **Исходные данные:** Данные о товарах, которые **предполагается хранить** в таблицах `product` и `queue`. Приоритезация основана на анализе полей `status_id` и `priority_id` из таблицы `queue`, связанных с информацией о товаре (`keyword`, `wekan_task_id`, `wekan_priority`) из таблицы `product`. Текущие методы приоритизации **будут преобразованы** в значения, соответствующие полям `status_id` и `priority_id` в таблице `queue`.

*   **Что фиксируем в DATA.md:**
    *   Для каждого рассмотренного товара в таблице `product`:
        *   `id`: Уникальный идентификатор товара.
        *   `keyword`: Ключевые слова или название для идентификации товара.
        *   `wekan_task_id`: ID задачи из Wekan (если применимо).
        *   `wekan_priority`: Уровень приоритета из Wekan (если применимо).
    *   Для каждого соответствующего элемента в таблице `queue`:
        *   `status_id`: ID статуса элемента в очереди (ссылка на `status`).
        *   `priority_id`: ID внутреннего приоритета для обработки (ссылка на `priority`).
        *   `note`: Любые примечания или контекст.
    *   Критерии отбора для перехода на следующий этап (например, определенные значения `status_id` и `priority_id`).
    *   Результат отбора: список `product.id`, выбранных для дальнейшей работы.

## 2. Поиск/Эффективность (Анализ Экономической Выгоды)

На этом этапе мы детально анализируем выбранные товары с точки зрения экономической выгоды и других факторов, используя данные из различных источников, которые в конечном итоге также будут отражены в БД.
*   **Исходные данные:** Информация о текущих ценах, скидках, купонах, кешбэке, стоимости доставки из различных источников (например, веб-сервисы, прайс-листы, данные конкурентов), которые должны быть сопоставлены с соответствующими полями в SCHEMA.md для последующей загрузки в БД. Эти данные будут в первую очередь сопоставляться с таблицами `offer` и `competitor_price`.
*   **Что фиксируем в DATA.md:**
    *   Для каждого выбранного товара:
        *   Финальная цена товара с учетом всех скидок и бонусов (`final_price`).
        *   Расчет потенциального кешбэка (`potential_cashback`).
        *   Сравнение с ценами конкурентов (если применимо) (`competitor_analysis_notes`).
        *   Причина выбора конкретного продавца/предложения (`offer_selection_reason`).

## 3. Идентификация и Настройка Пользователя

На этом этапе создается или идентифицируется тестовый пользователь, включая его учетные данные и адреса. Эти данные необходимы для дальнейшего формирования корзины и оформления заказа.

*   **Исходные данные:** Информация, необходимая для создания тестового пользователя (например, имя пользователя, email) и его адресов (улица, город, страна и т.д.).
*   **Что фиксируем в DATA.md:**
    *   Данные для таблицы `user_account`:
        *   `id` (placeholder, например, `user_test_001`)
        *   `username`
        *   `password` (для тестовых целей, может быть упрощенным)
        *   `email`
        *   `created_at` (Timestamp)
        *   `default_shipping_address_id` (FK, будет связано с `address.id`)
    *   Данные для таблицы `address` (может быть несколько адресов для пользователя):
        *   `id` (placeholder, например, `addr_001`)
        *   `street`
        *   `city`
        *   `state_province`
        *   `postal_code`
        *   `country`
        *   `building_apt`
        *   `details` (дополнительная информация, если есть)

## 4. Корзина (Формирование Заказа)

На этом этапе выбранные товары добавляются в корзину, назначается ответственный исполнитель и формируется заказ.

*   **Исходные данные:** Результаты этапа 2, информация о доступности товара, минимальном количестве для заказа.
*   **Что фиксируем в DATA.md:**
    *   Идентификатор корзины (`basket_id`).
    *   `user_account_id` (FK, из Этапа 3).
    *   Стратегия формирования корзины (`strategy` в таблице `basket`).
    *   Для каждого товара в корзине (в `basket_item`):
        *   Количество (`qty`).
        *   Цена на момент добавления (`price_at_add`).
        *   Промежуточная стоимость (`subtotal`).
        *   **Назначенный исполнитель** (`assigned_to_user_account_id`).
        *   Ссылка на исходный элемент очереди (`queue_id`).
    *   Общая стоимость корзины (`total_amount` в `basket`).
    *   Примененные купоны и промокоды.

## 5. Оплата/Кошелек

На этом этапе выбирается метод оплаты и фиксируется необходимая сумма.

*   **Исходные данные:** Общая стоимость заказа, доступные методы оплаты.
*   **Что фиксируем в DATA.md:**
    *   Данные для таблиц `payment`, `pay_method`, `wallet`:
        *   Выбранный метод и кошелек.
        *   Сумма платежа (`amount`).
        *   Статус и детали транзакции.
        *   Кешбэк (`cashback_received`).
        *   Дата платежа (`paid_at`).

## 6. Оформление Заказа и Доставка

Финальный этап, где данные связываются в единый заказ и отслеживается доставка.

*   **Исходные данные:** Данные пользователя (Этап 3), корзины (Этап 4), оплаты (Этап 5).
*   **Что фиксируем в DATA.md:**
    *   Данные для таблиц `order`, `order_item`, `shipment`:
        *   Финальный `order_id`.
        *   Дата и статус заказа.
        *   Общая сумма.
        *   Адреса доставки и биллинга.
        *   Трекинг-номер и стоимость доставки.
        *   Финальные данные по элементам заказа (`order_item`).

Следуя этим этапам, мы сможем собрать полный набор данных для тестового заказа в DATA.md, который затем будет использован для тщательной валидации и корректировки SCHEMA.md и, в конечном итоге, для упорядоченного заполнения базы данных SQLite.
