# Рабочий Процесс Тестового Заказа для Сбора Данных

Этот документ описывает этапы рабочего процесса тестового заказа, следуя которому мы будем извлекать и фиксировать данные в DATA.md. Цель - собрать структурированные данные, необходимые для валидации и корректировки схемы базы данных в SCHEMA.md. Весь процесс направлен на упорядоченное заполнение таблиц базы данных SQLite, созданных на основе SCHEMA.md, данными, соответствующими тестовому рабочему процессу.

## 1. Поиск и Приоритезация (Анализ предложений и бэклог)

На этом ключевом этапе мы сначала исследуем рынок для определения доступных предложений по интересующим товарам, а затем, на основе собранных данных, принимаем решение о приоритете их добавления в очередь (бэклог). Этот подход гарантирует, что приоритезация основана на реальных, измеримых факторах.

*   **Исходные данные:**
    1.  **Поиск предложений:** Информация о текущих ценах, скидках, купонах, кешбэке, стоимости доставки из различных источников (например, веб-сервисы, прайс-листы).
    2.  **Формирование бэклога:** Потенциально интересные товары (`keyword`), которые мы рассматриваем для заказа.

*   **Что фиксируем в DATA.md:**
    *   Сначала для каждого рассмотренного товара заполняем таблицу `product`:
        *   `id`: Уникальный идентификатор товара.
        *   `keyword`: Ключевые слова или название для идентификации товара.
    *   Затем для каждого товара исследуем и фиксируем данные в таблице `offer`:
        *   `product_id`: Ссылка на товар.
        *   `channel`: Источник предложения (например, AliExpress, Ozon).
        *   `price`: Цена товара.
        *   `status_id`: Статус предложения (например, "доступно", "нет в наличии").
        *   `available`: `TRUE` или `FALSE`.
        *   `acquisition_cost`: Затраты на привлечение (если применимо).
    *   На основе анализа данных из `offer`, мы принимаем решение о приоритете и заносим товар в таблицу `queue`:
        *   `product_id`: Ссылка на товар.
        *   `status_id`: Начальный статус в очереди (например, "Активен в очереди").
        *   `priority_id`: **Обоснованный** ID приоритета, определенный на основе цен, доступности и других факторов из таблицы `offer`.
        *   `note`: Любые примечания или контекст, объясняющий приоритет.

*   **Результат этапа:** Список `product.id`, добавленных в `queue` с осмысленно выставленным приоритетом, готовых для дальнейшей работы.

## 2. Идентификация и Настройка Пользователя

На этом этапе создается или идентифицируется тестовый пользователь, включая его учетные данные и адреса. Эти данные необходимы для дальнейшего формирования корзины и оформления заказа.

*   **Исходные данные:** Информация, необходимая для создания тестового пользователя (например, имя пользователя, email) и его адресов (улица, город, страна и т.д.).
*   **Что фиксируем в DATA.md:**
    *   Данные для таблицы `user_account`:
        *   `id` (placeholder, например, `user_test_001`)
        *   `username`
        *   `password` (для тестовых целей, может быть упрощенным)
        *   `email`
        *   `created_at` (Timestamp)
        *   `default_shipping_address_id` (FK, будет связано с `address.id`)
    *   Данные для таблицы `address` (может быть несколько адресов для пользователя):
        *   `id` (placeholder, например, `addr_001`)
        *   `street`
        *   `city`
        *   `state_province`
        *   `postal_code`
        *   `country`
        *   `building_apt`
        *   `details` (дополнительная информация, если есть)

## 3. Корзина (Формирование Заказа)

На этом этапе выбранные товары добавляются в корзину и формируется сам заказ, с фиксацией данных, которые будут загружены в таблицы `basket` и `basket_item` в БД.

*   **Исходные данные:** Результаты этапа 1, информация о доступности товара, минимальном количестве для заказа (если есть) - данные, предназначенные для последующей загрузки в таблицы `product`, `basket_item` и, возможно, `product_inventory` в БД. Также учитывается стратегия формирования корзины (`basket_strategy`) для оптимизации под купоны или сравнения.
*   **Что фиксируем в DATA.md:**
    *   Идентификатор корзины (для группировки товаров) (`basket_id`).
    *   `user_account_id` (FK, из Этапа 2).
    *   Стратегия формирования корзины (`basket_strategy`), соответствующая полю `strategy` в таблице `basket`.
    *   Для каждого товара в корзине (в `basket_item`):
        *   Количество (`qty`).
        *   Цена на момент добавления (`price_at_add`).
        *   Промежуточная стоимость (`subtotal`).
        *   Ссылка на исходный элемент очереди (`queue_id`).
    *   Общая стоимость корзины (`basket_total_amount`), соответствующая полю `total_amount` в таблице `basket`.
    *   Примененные купоны или промокоды (`applied_coupons`), предназначенные для фиксации (возможно, в отдельной таблице или в поле `details` заказа/платежа).
    *   Выбранный способ доставки и его стоимость (предварительно) (`preliminary_shipping_method`, `preliminary_shipping_cost`), предназначенные для фиксации в таблице `shipment`.
    *   Промежуточный статус корзины/заказа (например, "в корзине", "оформляется"), соответствующий статусам в SCHEMA.md (связанным с таблицами `basket` или `order`).
    *   Итоговая стоимость с учетом доставки и скидок (предварительно) (`preliminary_final_amount`).

## 4. Оплата/Кошелек

На этом этапе выбирается метод оплаты, вносится и фиксируется необходимая сумма, с целью подготовки данных для таблиц `payment`, `pay_method` и `wallet` в БД.

*   **Исходные данные:** Общая стоимость заказа, доступные методы оплаты, информация о кошельках - данные, которые будут сопоставлены со `SCHEMA.md` и загружены в БД.
*   **Что фиксируем в DATA.md:**
    *   Идентификатор платежа (для группировки) (`payment_id`).
    *   Идентификатор заказа, к которому относится платеж (`order_id` - будет назначен позже, на этапе 5).
    *   Выбранный метод оплаты (`pay_method_name`), соответствующий полю `name` в таблице `pay_method`.
    *   Использованный кошелек или платежный аккаунт (если применимо) (`wallet_name`), соответствующий полю `name` в таблице `wallet`.
    *   Сумма платежа (`payment_amount`), соответствующая полю `amount` в таблице `payment`.
    *   Статус платежа (`payment_status`), соответствующий статусам в `SCHEMA.md` (связанным с таблицей `payment` через `status_id`).
    *   Расчетный или полученный кешбэк (`cashback_received`), соответствующий полю `cashback_received` в таблице `payment`.
    *   Детали транзакции (если доступны и не содержат чувствительных данных) (`transaction_details`), предназначенные для фиксации в БД (возможно, в поле `details` таблицы `payment`).
    *   Дата и время платежа (`paid_at`), соответствующее полю `paid_at` в таблице `payment`.

## 5. Оформление Заказа и Доставка

На этом этапе используются данные пользователя для оформления заказа и его окончательной регистрации в системе, с целью заполнения таблиц `order`, `order_item` (финализация), `shipment` и уточнения связи `payment.order_id` в БД.

*   **Исходные данные:** Данные пользователя (из Этапа 2), финальная информация о корзине (из Этапа 3), оплате (из Этапа 4) и доставке.
*   **Что фиксируем в DATA.md:**
    *   Идентификатор пользователя (`user_account_id`, из Этапа 2).
    *   Идентификатор финального заказа (`order_id`), соответствующий первичному ключу таблицы `order`.
    *   Дата и время оформления заказа (`order_date`), соответствующее полю `order_date` в таблице `order`.
    *   Финальный статус заказа (`order_status`), соответствующий статусам в `SCHEMA.md` (связанным с таблицей `order` через `status_id`).
    *   Общая итоговая сумма заказа (`order_total_amount`), соответствующая полю `total_amount` в таблице `order`.
    *   Идентификатор выбранного адреса доставки (`shipping_address_id` из Этапа 2), соответствующий внешнему ключу в таблице `order` и `shipment`.
    *   Идентификатор выбранного биллингового адреса (`billing_address_id` из Этапа 2, если отличается от адреса доставки).
    *   Идентификатор платежа (`payment_id` из Этапа 4), который будет связан с этим `order_id`.
    *   Информация о доставке: идентификатор отгрузки (`shipment_id`), трекинг-номер (`tracking_number`), стоимость доставки (`shipping_cost`), предполагаемые/фактические даты отгрузки/доставки (`shipped_at`, `delivered_at`).
    *   Уточненные данные по элементам заказа (`order_item`), включая финальные цены, скидки, стоимость товаров (`sale_price`, `discount_amount`, `cost_of_goods_sold`), связывая их с `order_id`.

Следуя этим этапам, мы сможем собрать полный набор данных для тестового заказа в DATA.md, который затем будет использован для тщательной валидации и корректировки SCHEMA.md и, в конечном итоге, для упорядоченного заполнения базы данных SQLite.
