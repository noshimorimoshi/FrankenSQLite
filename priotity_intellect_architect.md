# Рабочее соглашение v0.0 - Архитектура Интеллектуальной Приоритезации

1. Главная миссия: Наша основная задача — построить отказоустойчивую и масштабируемую экосистему для управления закупками, где Wekan является источником задач, а наша Система отслеживания заказов — исполнительным механизмом.

2. Ключевое решение: Внешний "Рейтинговый Микросервис" (Wekan-Rating-Service) Мы пришли к выводу, что логика приоритезации не должна находиться ни в Wekan, ни в каждом приложении-потребителе. Мы создаем для этой цели отдельный микросервис на базе Strapi, node:sqlite или Prisma, который будет единым центром "интеллекта".

3. Архитектура и Принципы "Wekan-Rating-Service":

Принцип 1: Иерархический рейтинг. Приоритет задачи (wekan_priority) — это динамически вычисляемое значение, основанное на многоуровневой иерархии весов и рейтингов:

Wekan App (экземпляр Wekan): У каждого инстанса Wekan свой вес.
Board (доска): У каждой доски свой весовой коэффициент.
List (список): У каждого списка свой весовой коэффициент.
User (пользователь): У каждого пользователя есть свой рейтинг доверия.
Labels (метки): У ключевых меток есть свой числовой рейтинг.
Принцип 2: Самообучаемая База Знаний (Автоматическая синхронизация). Мы отказываемся от ручного заполнения данных в Strapi, node:sqlite или Prisma. Сервис будет работать по принципу "on-demand cache":

Когда от приложения-потребителя поступает запрос с идентификаторами (appId, boardId, listId и т.д.), сервис ищет их в своей базе.
Если ID не найден, сервис использует API-ключ для соответствующего Wekan App, делает обратный запрос в Wekan, получает нужную информацию (например, имя доски) и автоматически создает новую запись с весами и рейтингами по-умолчанию.
Администратор может позже зайти в админ-панель Strapi, node:sqlite или Prisma и скорректировать эти значения по-умолчанию, но система не остановит свою работу в ожидании ручного ввода.
Принцип 3: Централизованная логика. Вся формула расчета и ее коэффициенты хранятся в Strapi, node:sqlite или Prisma. Любые изменения в логике приоритезации делаются в одном месте и мгновенно применяются ко всем приложениям-потребителям.

4. Наш текущий прогресс:

Мы завершили этап архитектурного проектирования "Wekan-Rating-Service".
Мы определили ключевые модели данных (Content-Types) для Strapi, node:sqlite или Prisma и логику работы кастомного API-контроллера calculate-priority.
Мы пришли к согласию о необходимости автоматической синхронизации для обеспечения отказоустойчивости.
5. Наша следующая задача:

Действие: Начать практическую реализацию "Wekan-Rating-Service".
Первый шаг: Создать новый проект на Strapi, node:sqlite или Prisma и определить в нем Content-Types (модели) согласно нашей архитектуре: WekanApp, WekanBoardConfig, WekanListConfig, WekanUserRating, WekanLabelRating и RatingConfiguration.

Пример Простой обёртки для CRUD на базе node:sqlite описан в файле node/crud/priority_intellect_architect.js