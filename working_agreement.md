### **Рабочее соглашение (версия 6.3) - Совместная работа и Процесс**

**0. Принципы нашего взаимодействия (Как мы работаем вместе):**
*   **Диалог и Гибкость:** Если мы обнаруживаем, что план неоптимален или что-то неясно, мы **останавливаемся, обсуждаем и корректируем курс**. Я (AI ассистент) не вношу изменения в ключевые документы без вашего согласия.
*   **Итеративное наполнение ("Вопрос-Ответ"):** При работе с `DATA.md` мы "проживаем" процесс следуя порядку, изложенному в DATA_ORDER.md. Я задаю вопросы для заполнения полей. **Мы совместно решаем**, что делать, если данных нет: оставить поле пустым или использовать правдоподобные вымышленные значения.
*   **Совместная ответственность:** Мы вместе принимаем ключевые решения о схеме (`SCHEMA.md`) и процессе, зафиксированном в этом документе.
*   **`DATA.md` как "Живой Пример"**: Мы признаем, что `DATA.md` является рабочим документом для иллюстрации структуры и процесса. Он не обязан содержать исчерпывающие данные для всех таблиц на всех этапах.

**1. Главная миссия:**
*   Итеративно построить и проверить оптимальную схему данных (`SCHEMA.md`) и рабочий процесс для системы отслеживания заказов, используя `DATA.md` как полигон для проверки наших гипотез.

**2. Наш Текущий Рабочий Процесс (Гипотеза для проверки):**
*   *Этот раздел описывает наш **текущий** план. Согласно принципам, изложенным выше, мы можем и должны его пересматривать.*
*   **Этап 1: Приоритезация и Исследование.**
    1.  **`product`**: Фиксируем товар и его приоритет.
    2.  **`breadcrumb`**: Определяем иерархическую категорию ("хлебные крошки") для товара.
    3.  **`catalog`**: Создаем "карточку" товара, связывая ее с `breadcrumb`.
    4.  **`media`**: Добавляем ссылки на медиафайлы товара.
    5.  **`offer`**: Находим рыночные предложения для товара.
*   **Этап 2: Формирование Корзины и Заказа.**
    1.  **`queue`**: *(Вопрос на обсуждение: нужна ли эта таблица, или она является атрибутом `offer` или `basket`?)* Выстраиваем очередь на покупку.
    2.  **`basket` / `basket_item`**: Добавляем лучшие предложения в корзину.
    3.  **`order` / `order_item`**: Оформляем заказ.

**3. Ключевые технические решения и симуляции:**
*   **Хранение медиафайлов (временно)**:
    *   В таблице `media` поле `url` будет содержать **имя файла** (например, `main_image.jpg`), пока не будет реализовано файловое хранилище.
    *   Поле `type` остается обязательным для явного указания типа контента ('image', 'video').

**4. Наш отлаженный рабочий цикл (для Этапа 1):**
*   **1. Выборка Продукта:** Я автоматически определяю следующий `product` для обработки. Для этого я нахожу в `DATA.md` все товары из таблицы `product`, `id` которых еще не присутствуют в колонке `product_id` таблицы `catalog`. Из этого списка я выбираю товар с **наивысшим** значением `wekan_priority`.
*   **2. Определение Категории (`breadcrumb`):** Мы совместно определяем и фиксируем иерархию категорий ("хлебные крошки") для выбранного продукта. При необходимости я добавляю новые категории в таблицу `breadcrumb`.
*   **3. Заполнение Карточки (`catalog`):** Мы совместно заполняем и вносим все необходимые данные для создания новой записи в таблице `catalog`, связывая ее с `product` и `breadcrumb`.
*   **4. Повторение:** Мы возвращаемся к шагу 1 для следующего продукта.
