### **Рабочее соглашение (версия 8.0) - Совместная работа и Процесс**

**0. Принципы нашего взаимодействия (Как мы работаем вместе):**
*   **Диалог и Гибкость:** Если мы обнаруживаем, что план неоптимален или что-то неясно, мы **останавливаемся, обсуждаем и корректируем курс**. Я (AI ассистент) не вношу изменения в ключевые документы без вашего согласия.
*   **Процесс, управляемый Пайплайном:** Наш рабочий процесс управляется файлом `PIPELINE.md`. Мы берем задачи из него в соответствии с приоритетом и статусом, обрабатываем их и обновляем их состояние, фиксируя историю в `tracker.md`.
*   **Совместная ответственность:** Мы вместе принимаем ключевые решения о схеме (`SCHEMA.md`) и процессе, зафиксированном в этом документе.
*   **`waterflow.md` как "Живой Пример"**: Мы признаем, что `waterflow.md` является рабочим документом для иллюстрации структуры и процесса. Он не обязан содержать исчерпывающие данные для всех таблиц на всех этапах.

**1. Главная миссия:**
*   Итеративно построить и проверить оптимальную схему данных (`SCHEMA.md`) и рабочий процесс для системы отслеживания заказов, используя `waterflow.md` как полигон для проверки наших гипотез.

**2. Ключевые Концепции и Метрики:**
*   **Итоговая Стоимость Приобретения (ИСП):** Это ключевая бизнес-метрика, которую мы используем для принятия решений о покупке. Это не просто цена товара, а **расчетная величина**, которая учитывает цену после скидки продавца, стоимость доставки и вычет всех применимых кэшбэк-предложений.
*   **"Главная Таксономия" (Master Taxonomy):** Мы используем собственную, единую иерархию категорий (`breadcrumb`) для нашего склада и витрины (`internal_master`). Категории с внешних маркетплейсов (`marketplace`) также сохраняются для аналитики, но не влияют на внутреннюю структуру.

**3. Наш Текущий Рабочий Процесс (Гибридная Модель):**
*   *Этот раздел описывает наш **текущий** план. Мы можем и должны его пересматривать.*
*   **Этап 1: Индивидуальная обработка.**
    1.  Задачи (например, новые `product`) обрабатываются индивидуально согласно их приоритету в `PIPELINE.md`.
    2.  Они проходят через последовательность статусов: `New` -> `Cataloging` -> `Pricing`.
*   **Этап 2: Квалификация.**
    1.  После сбора всех цен и кэшбэков, задача переходит в статус `Qualification`.
    2.  На этом этапе мы принимаем решение, для каких акционных корзин (`Комбо`, `Нихао` и т.д.) данный товар является кандидатом.
*   **Этап 3: Мониторинг "Пред-корзин".**
    1.  Товар получает статус-кандидат (например, `Candidate for Combo`).
    2.  Мы постоянно отслеживаем общую ИСП товаров в каждой "пред-корзине".
*   **Этап 4: Стратегическое формирование корзины.**
    1.  Когда сумма в одной из "пред-корзин" достигает порога акции, мы формируем реальную `basket`.

**5. Архитектурные гипотезы и отложенные идеи:**
*   **Переход к микросервисной архитектуре:** Зафиксирована долгосрочная цель по раздроблению монолитной базы данных на независимые, переиспользуемые сервисы. Это предполагает выделение таких сущностей как "кто" (`USER_SERVICE.md`) и "на что" (`LEDGER_SERVICE.md`) в отдельные сервисы, с которыми наша основная система будет общаться через API и транзакции. Эта цель влияет на то, как мы проектируем новые функции, подталкивая нас к созданию независимых модулей.
*   **Рейтинговый сервис (`priority_intellect_architect.md`):** Первый кандидат на выделение в микросервис.
*   **Система трекинга времени:** `tracker.md` полностью удовлетворяет нашей потребности в отслеживании "времени цикла" (Cycle Time). Более сложные гипотезы отложены.

----
Пост скриптум: Прежде чем ответить, оцени неопределённость своего ответа. Если она больше 0.1, задай нам уточняющие вопросы, пока она не станет 0.1 или ниже